<?xml version="1.0"?>

<Protocol name="ReverseGeocache" prefix="" api="1" version="1.0.0.a" endian="big" supportInt64="false" supprtLongBitfield="false" supportFloat64="false" supportSpecialFloat="false" comment=
"">

    <Include name="string.h" comment="C string manipulation function header" global="true"/>
    <!--
    <Include name="indices.h" comment="indices.h is included to for array length enumerations"/>
    -->
    
    <Enum name="Packet" comment="USB Packet types">
        <Value name="MSG_RESET_INTO_BOOTLOADER" value="0x0A"/>
        <Value name="MSG_ENABLE_DEBUG_MODE"/>
        
        <Value name="MSG_SYSTEM_INFO" value="0xA0"/>
        
        <Value name="MSG_CLUE_INFO" value="0xB0"/>
        
        <Value name="MSG_CLUE_LINE" value="0xC0"/>
        
        <Value name="MSG_UNLOCK" value="0xD0"/>
        <Value name="MSG_LOCK"/>
        
        <Value name="MSG_NEXT_CLUE" value="0xE0"/>
        <Value name="MSG_PREV_CLUE"/>
        <Value name="MSG_FIRST_CLUE"/>
        <Value name="MSG_LAST_CLUE"/>
        
        <Value name="MSG_SET_CLUE_COUNT" value="0xF0"/>
        <Value name="MSG_INVALIDATE_CLUES"/>
        <Value name="MSG_VALIDATE_CLUES"/>
    </Enum>
    
    <Enum name="ClueTypes">
        <Value name="CLUE_NO_HINT" value="0x00"/>
        <Value name="CLUE_SHOW_DISTANCE"/>
        <Value name="CLUE_SHOW_LOCATION"/>
        <Value name="CLUE_WARMER_COOLER"/>
        <Value name="CLUE_SHOW_HEADING"/>
        <Value name="CLUE_SHOW_CARDINAL"/>
        
        <Value name="NUM_CLUE_TYPES"/>
    </Enum>
    
    <Structure name="BoxStatus"  file="boxdefines">
        <Data name="locked" inMemoryType="bitfield1"/>
        <Data name="gpsConnection" inMemoryType="bitfield1" comment="1 = GPS unit detected"/>
        <Data name="gpsStatus" inMemoryType="bitfield2" comment="GPS Status"/>
        <Data name="charging" inMemoryType="bitfield1" comment="Battery charging status"/>
        <Data name="debug" inMemoryType="bitfield1"/>
    </Structure>
    
    <Structure name="ClueOptions" file="boxdefines">
        <Data name="centerText" inMemoryType="bitfield1"/>
    </Structure>

    
    <Structure name="BoxInfo" file="boxdefines">
        <Data name="serialNumber" inMemoryType="unsigned16"/>
        <Data name="versionMajor" inMemoryType="unsigned8"/>
        <Data name="versionMinor" inMemoryType="unsigned8"/>
        <Data name="pcbRevision" inMemoryType="unsigned8"/>
        <Data name="status" struct="BoxStatus"/>
        <Data name="charge" inMemoryType="unsigned8"/>
        <Data name="currentClue" inMemoryType="unsigned8"/>
        <Data name="totalClues" inMemoryType="unsigned8"/>
    </Structure>
    
    <Structure name="Waypoint" file="boxdefines">
        <Data name="lat" inMemoryType="float"/>
        <Data name="lng" inMemoryType="float"/>
        <Data name="threshold" inMemoryType="unsigned16"/>
        <Data name="type" enum="ClueTypes"/>
        <Data name="options" struct="ClueOptions"/>
    </Structure>
    
    <!-- Commands -->
    <Packet name="Unlock" ID="MSG_UNLOCK" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="Lock" ID="MSG_LOCK" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="NextClue" ID="MSG_NEXT_CLUE" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="PrevClue" ID="MSG_PREV_CLUE" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="FirstClue" ID="MSG_FIRST_CLUE" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="LastClue" ID="MSG_LAST_CLUE" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="Bootload" ID="MSG_RESET_INTO_BOOTLOADER" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="EnableDebug" ID="MSG_ENABLE_DEBUG_MODE" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="SetClueCount" ID="MSG_SET_CLUE_COUNT" file="boxpackets" parameterInterface="true">
        <Data name="clueCount" inMemoryType="unsigned8"/>
    </Packet>
    
    <Packet name="ValidateClues" ID="MSG_VALIDATE_CLUES" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="InvalidateClues" ID="MSG_VALIDATE_CLUES" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="BoxInfo" ID="MSG_SYSTEM_INFO" file="boxpackets" parameterInterface="true">
        <Data name="info" struct="BoxInfo"/>
    </Packet>
    
    <Packet name="RequestBoxInfo" ID="MSG_SYSTEM_INFO" file="boxpackets" parameterInterface="true">
    </Packet>
    
    <Packet name="ClueInfo" ID="MSG_CLUE_INFO" file="boxpackets" parameterInterface="true">
        <Data name="clueNumber" inMemoryType="unsigned8"/>
        <Data name="clueInfo" struct="Waypoint"/>
    </Packet>
    
    <Packet name="RequestClueInfo" ID="MSG_CLUE_INFO" file="boxpackets" parameterInterface="true">
        <Data name="clueNumber" inMemoryType="unsigned8"/>
    </Packet>
    
    <Packet name="ClueLine" ID="MSG_CLUE_LINE" file="boxpackets" parameterInterface="true">
        <Data name="clueNumber" inMemoryType="unsigned8"/>
        <Data name="lineNumber" inMemoryType="unsigned8"/>
        <Data name="lineText" inMemoryType="signed8" array="40" encodedType="string"/>
    </Packet>
    
    <Packet name="RequestClueLine" ID="MSG_CLUE_LINE" file="boxpackets" parameterInterface="true">
        <Data name="clueNumber" inMemoryType="unsigned8"/>
        <Data name="lineNumber" inMemoryType="unsigned8"/>
    </Packet>
</Protocol>
